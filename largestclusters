#!/usr/bin/nodejs

var fs = require('fs');
var logParser = require('./logParser');

fs.readFile(process.argv[2], 'utf8', function(err, data) {
    if (err) {
        return console.log(err);
    }

    var log = logParser.readString(data);
    var logEntries = log.entries;

    var GiB = 1024 * 1024 * 1024;
    var begin = process.argv[3] * GiB;
    var end = process.argv[4] * GiB;

    logEntries
        .filter(function(entry) {
            return entry.flag !== "+" && entry.begin >= begin && entry.begin <= end;
        })
        .sort(function(left, right) {
            return right.size - left.size || left.begin - right.begin;
        })
        .forEach(function(entry) {
            console.log(entry.raw);
        });
});
